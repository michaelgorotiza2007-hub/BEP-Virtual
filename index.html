<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco Estudiantil Peninsular</title>
    <link rel="stylesheet" href="estilos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div id="toast-container"></div>

    <section id="intro-screen">
        <div class="glass-card intro-content">
            <div class="logo-container-intro">
                <img src="logo.jpg" alt="Logo BEP" class="logo-intro">
            </div>
            <h1>Banco Estudiantil <span class="text-gold">Peninsular</span></h1>
            <p>Tu futuro financiero comienza aquí</p>
            <div class="loading-bar"><div class="progress"></div></div>
            <button onclick="cerrarIntro()" class="btn-gold mt-4">Ingresar al Sistema</button>
        </div>
    </section>

    <section id="auth-screen" class="oculto">
        <div class="glass-card auth-box">
            <div class="auth-header-modern">
                <img src="logo.jpg" class="auth-logo">
                <h2>Banca Virtual</h2>
                <p>Bienvenido</p>
            </div>
            <div class="tabs-modern">
                <button onclick="toggleAuth('login')" id="tab-login" class="active">Iniciar Sesión</button>
                <button onclick="toggleAuth('registro')" id="tab-registro">Registrarse</button>
            </div>

            <div id="form-login" class="form-group fade-in">
                <div class="input-floating">
                    <i class="fas fa-user"></i>
                    <input type="text" id="login-user" placeholder=" ">
                    <label>Usuario</label>
                </div>
                <div class="input-floating">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="login-pass" placeholder=" ">
                    <label>Contraseña</label>
                </div>
                <button onclick="iniciarSesion()" class="btn-primary full-width glow-btn">INGRESAR</button>
            </div>

            <div id="form-registro" class="form-group oculto fade-in">
                <div id="registro-paso-1" class="profile-cards-container">
                    <div class="profile-card" onclick="seleccionarPerfil('cliente')">
                        <div class="icon-circle blue"><i class="fas fa-user"></i></div>
                        <h3>Cliente</h3>
                        <p>Cuenta de ahorros y préstamos</p>
                        <button class="btn-card blue">Elegir</button>
                    </div>
                    <div class="profile-card" onclick="seleccionarPerfil('staff')">
                        <div class="icon-circle gold"><i class="fas fa-id-card-alt"></i></div>
                        <h3>Personal</h3>
                        <p>Administradores y Cajeros</p>
                        <button class="btn-card gold">Elegir</button>
                    </div>
                </div>

                <div id="registro-paso-2" class="oculto">
                    <button onclick="volverSeleccion()" class="btn-text mb-2"><i class="fas fa-arrow-left"></i> Volver</button>
                    <div class="scrollable-form">
                        <div class="profile-upload-container">
                            <label for="reg-foto" class="upload-btn"><i class="fas fa-camera"></i> Subir Foto</label>
                            <input type="file" id="reg-foto" accept="image/*" onchange="previewImage()">
                            <img id="avatar-preview" src="" class="hidden">
                        </div>
                        <div class="grid-2-col-small">
                            <input type="text" placeholder="Nombres" id="reg-nombres">
                            <input type="text" placeholder="Apellidos" id="reg-apellidos">
                        </div>
                        <input type="text" placeholder="Cédula" id="reg-cedula">
                        <input type="tel" placeholder="Celular" id="reg-telefono">
                        <hr class="divider-line">
                        <input type="text" placeholder="Usuario" id="reg-user">
                        <input type="password" placeholder="Contraseña" id="reg-pass">
                        
                        <div id="staff-code-area" class="hidden mt-2">
                            <label class="small-label text-gold">Código Institucional</label>
                            <input type="password" id="reg-staff-code" placeholder="Ej: BEP2025 o CAJA2025">
                        </div>

                        <div class="terms-container mt-2">
                            <input type="checkbox" id="reg-terms">
                            <label for="reg-terms">Acepto términos y condiciones</label>
                        </div>
                        <button onclick="registrarUsuario()" class="btn-gold full-width mt-2">Finalizar Registro</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="dashboard" class="oculto">
        <nav class="sidebar">
            <div class="brand">
                <img src="logo.jpg" class="logo-sidebar"> <span>BEP Cliente</span>
            </div>
            <div class="user-profile-mini">
                <img id="nav-avatar" src="" class="avatar-sidebar">
                <div class="user-details">
                    <span id="nav-user">Usuario</span>
                    <span id="nav-acc" class="account-badge">...</span>
                </div>
            </div>
            <ul class="nav-links">
                <li onclick="mostrarPanel('inicio')" class="active"><i class="fas fa-home"></i> Inicio</li>
                <li onclick="mostrarPanel('operaciones')"><i class="fas fa-wallet"></i> Operaciones</li>
                <li onclick="mostrarPanel('terceros')"><i class="fas fa-users"></i> A Terceros</li>
                <li onclick="mostrarPanel('servicios')"><i class="fas fa-file-invoice-dollar"></i> Préstamos</li>
                <li onclick="mostrarPanel('otros')"><i class="fas fa-concierge-bell"></i> Pagos y Servicios</li> <li onclick="cerrarSesion()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Salir</li>
            </ul>
        </nav>

        <main class="content-area">
            <header>
                <h2 id="header-title">Mi Banca</h2>
                <div class="date-display" id="current-date">--/--/----</div>
            </header>

            <div id="panel-inicio" class="view active fade-in">
                <div class="card-balance gradient-blue">
                    <div class="card-details">
                        <span>Saldo Disponible</span>
                        <h1 id="main-balance">$0.00</h1>
                        <div class="account-number-display">
                            Cta: <span id="display-acc-number">****</span>
                            <button onclick="copiarCuenta()" class="btn-icon"><i class="far fa-copy"></i></button>
                        </div>
                    </div>
                    <div class="card-logo"><i class="fab fa-cc-visa fa-3x"></i></div>
                </div>
                <div class="recent-activity glass-panel">
                    <h3>Movimientos Recientes</h3>
                    <ul id="activity-list" class="transaction-list"></ul>
                </div>
            </div>

            <div id="panel-operaciones" class="view oculto fade-in">
                <div class="glass-panel">
                    <h3>Transferencias Directas</h3>
                    <div class="form-grid-terceros">
                        <input type="text" id="tercero-cuenta" placeholder="Cuenta Destino">
                        <input type="number" id="tercero-monto" placeholder="Monto">
                    </div>
                    <button onclick="operar('transferencia')" class="btn-blue full-width">Transferir Ahora</button>
                </div>
                <div class="glass-panel mt-4">
                    <h3>Depósito de Cheques</h3>
                    <div class="cheque-design">
                        <div class="cheque-header"><span>CHEQUE BEP</span></div>
                        <input type="text" id="cheque-beneficiario" placeholder="Beneficiario...">
                        <input type="number" id="cheque-monto" placeholder="$ Valor">
                        <button onclick="operar('cobrar-cheque')" class="btn-silver mt-2">Depositar</button>
                    </div>
                </div>
            </div>

            <div id="panel-terceros" class="view oculto fade-in">
                <div class="glass-panel"><h3>Servicios a Terceros</h3><p>Use la pestaña Operaciones para transferir.</p></div>
            </div>

            <div id="panel-servicios" class="view oculto fade-in">
                <div class="glass-panel">
                    <h3>Solicitud de Crédito</h3>
                    <div class="grid-2-col">
                        <input type="number" id="prestamo-monto" placeholder="Monto ($)">
                        <input type="number" id="prestamo-ingresos" placeholder="Ingresos Mensuales ($)">
                    </div>
                    <input type="text" id="prestamo-motivo" placeholder="Motivo (Ej: Estudios, Salud)" class="mt-2">
                    <input type="text" id="prestamo-trabajo" placeholder="Lugar de Trabajo" class="mt-2">
                    <select id="prestamo-plazo" class="mt-2">
                        <option value="3">3 Meses (5% Interés)</option>
                        <option value="6">6 Meses (10% Interés)</option>
                        <option value="12">12 Meses (15% Interés)</option>
                    </select>
                    <button onclick="solicitarPrestamo()" class="btn-gold full-width mt-4">Enviar Solicitud</button>
                    
                    <div id="estado-prestamo" class="status-box mt-4">No tienes solicitudes activas.</div>
                    
                    <div id="amortizacion-user-container" class="hidden mt-4 glass-panel" style="background: rgba(0,0,0,0.2);">
                        <h4 class="text-gold mb-2"><i class="fas fa-table"></i> Tu Tabla de Amortización</h4>
                        <div class="table-responsive">
                            <table class="admin-table">
                                <thead><tr><th>Mes</th><th>Cuota</th><th>Saldo Restante</th></tr></thead>
                                <tbody id="tabla-amortizacion-user"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panel-otros" class="view oculto fade-in">
                <div class="glass-panel">
                    <h3><i class="fas fa-hand-holding-usd text-gold"></i> Pagos de Crédito</h3>
                    <div class="glass-card-mini" style="max-width:400px; margin: 20px auto; text-align:center;">
                        <div class="icon-header"><i class="fas fa-money-bill-wave fa-2x text-green"></i></div>
                        <h4>Abonar a mi Préstamo</h4>
                        <p class="small-text mb-2">Se debitará de tu saldo disponible.</p>
                        
                        <div id="area-pago-prestamo">
                            <p id="info-deuda-display" class="mb-2">Consultando...</p>
                            <div id="form-pago-inputs" class="hidden">
                                <input type="number" id="monto-pago-prestamo" placeholder="Monto a pagar ($)">
                                <button onclick="pagarPrestamoUser()" class="btn-green full-width mt-2">Realizar Pago</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </section>

    <section id="admin-panel" class="oculto">
        <nav class="sidebar admin-sidebar">
            <div class="brand-column">
                <img src="logo.jpg" class="logo-sidebar mb-2">
                <span class="text-gold bold">ADMINISTRACIÓN</span>
            </div>
            <ul class="nav-links mt-4">
                <li onclick="mostrarPanelAdmin('dashboard')"><i class="fas fa-chart-line"></i> Dashboard</li>
                <li onclick="mostrarPanelAdmin('usuarios')" class="active"><i class="fas fa-users"></i> Directorio</li>
                <li onclick="mostrarPanelAdmin('prestamos')"><i class="fas fa-file-invoice-dollar"></i> Solicitudes</li>
                <li onclick="mostrarPanelAdmin('transacciones')"><i class="fas fa-list"></i> Historial</li>
                <li onclick="cerrarSesion()" class="logout-btn"><i class="fas fa-power-off"></i> Salir</li>
            </ul>
        </nav>

        <main class="content-area">
            <header><h2>Gerencia General</h2></header>

            <div id="admin-dashboard" class="view-admin oculto fade-in">
                <div class="alert-container grid-3-col mb-2">
                    <div class="stat-card"><h3>Capital</h3><h2 id="total-capital" class="text-green">$0.00</h2></div>
                    <div class="stat-card"><h3>Estado</h3><h2 id="estado-reserva">---</h2></div>
                </div>
                <div class="grid-2-col">
                    <div class="glass-panel"><canvas id="graficoPastel"></canvas></div>
                    <div class="glass-panel"><canvas id="graficoBarras"></canvas></div>
                </div>
            </div>

            <div id="admin-usuarios" class="view-admin active fade-in">
                <button onclick="cargarUsuariosAdmin()" class="btn-blue mb-2 full-width"><i class="fas fa-sync"></i> Actualizar Listas</button>

                <div class="glass-panel">
                    <h3><i class="fas fa-user-friends text-gold"></i> Cartera de Clientes</h3>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead><tr><th>Foto</th><th>Nombre</th><th>Cédula</th><th>Saldo</th><th>Acciones</th></tr></thead>
                            <tbody id="tabla-clientes-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="glass-panel mt-4">
                    <h3><i class="fas fa-id-card-alt text-green"></i> Nómina de Personal</h3>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead><tr><th>Foto</th><th>Nombre</th><th>Rol</th><th>Contacto</th><th>Acciones</th></tr></thead>
                            <tbody id="tabla-trabajadores-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="admin-detalle-cliente" class="view-admin oculto fade-in">
                <button onclick="cerrarDetalleCliente()" class="btn-text mb-2"><i class="fas fa-arrow-left"></i> Volver</button>
                <div class="glass-panel">
                    <div class="perfil-header-admin">
                        <img id="detalle-foto" src="" class="avatar-sidebar" style="width:80px; height:80px;">
                        <div>
                            <h2 id="detalle-nombre" class="text-gold">---</h2>
                            <p id="detalle-cedula">C.I: ---</p>
                            <p id="detalle-cuenta">Cuenta: ---</p>
                        </div>
                        <div style="margin-left:auto; text-align:right;">
                            <small>Saldo Actual</small>
                            <h2 id="detalle-saldo" class="text-green">$0.00</h2>
                        </div>
                    </div>
                    <hr class="divider-line">
                    
                    <h3>Estado del Préstamo</h3>
                    <div id="detalle-info-prestamo" class="mt-2"></div>

                    <div id="detalle-amortizacion-container" class="hidden mt-4">
                        <h4>Tabla de Amortización Activa</h4>
                        <div class="table-responsive">
                            <table class="admin-table">
                                <thead><tr><th>Mes</th><th>Cuota</th><th>Saldo Restante</th></tr></thead>
                                <tbody id="tabla-amortizacion-admin"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="admin-prestamos" class="view-admin oculto fade-in">
                <div class="glass-panel">
                    <h3>Solicitudes Pendientes</h3>
                    <button onclick="cargarSolicitudesAdmin()" class="btn-green mb-2">Actualizar</button>
                    <div id="lista-solicitudes-prestamo" class="requests-grid"></div>
                </div>
            </div>

            <div id="admin-transacciones" class="view-admin oculto fade-in">
                <div class="glass-panel">
                    <h3>Historial Global</h3>
                    <button onclick="cargarTransaccionesGlobales()" class="btn-blue mb-2">Refrescar</button>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead><tr><th>Fecha</th><th>Usuario</th><th>Detalle</th><th>Monto</th></tr></thead>
                            <tbody id="tabla-transacciones-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </section>

    <section id="cajero-panel" class="oculto">
        <nav class="sidebar" style="border-right: 2px solid #27ae60;">
            <div class="brand-column">
                <i class="fas fa-cash-register fa-3x text-green mb-2"></i>
                <span class="text-green bold">VENTANILLA</span>
            </div>
            <div class="user-profile-mini mt-4">
                <div class="user-details"><span id="cajero-name-display">Cajero</span></div>
            </div>
            <ul class="nav-links mt-4">
                <li onclick="mostrarPanelCajero('operaciones')" class="active"><i class="fas fa-coins"></i> Operaciones</li>
                <li onclick="mostrarPanelCajero('otros')"><i class="fas fa-file-invoice-dollar"></i> Cobro Préstamos</li> <li onclick="cerrarSesion()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Salir</li>
            </ul>
        </nav>

        <main class="content-area">
            <header><h2>Módulo de Caja</h2></header>

            <div id="cajero-operaciones" class="view-cajero fade-in">
                <div class="glass-panel">
                    <h3><i class="fas fa-search"></i> Buscar Cliente</h3>
                    <div class="grid-2-col" style="grid-template-columns: 3fr 1fr;">
                        <input type="text" id="cajero-search-input" placeholder="Cuenta o Cédula">
                        <button onclick="buscarClienteCajero()" class="btn-primary">Buscar</button>
                    </div>
                </div>
                <div id="cajero-cliente-info" class="glass-panel oculto fade-in">
                    <div class="client-card-cajero">
                        <img id="cajero-client-foto" src="" class="avatar-sidebar">
                        <div>
                            <h2 id="cajero-client-nombre">Cliente</h2>
                            <p>Saldo: <span id="cajero-client-saldo" class="text-green">$0.00</span></p>
                        </div>
                    </div>
                    <hr class="divider-line">
                    <div class="grid-2-col">
                        <div>
                            <label>Operación</label>
                            <select id="cajero-tipo-op">
                                <option value="deposito">Depósito (Ingreso)</option>
                                <option value="retiro">Retiro (Egreso)</option>
                            </select>
                        </div>
                        <div><label>Monto</label><input type="number" id="cajero-monto-op" placeholder="0.00"></div>
                    </div>
                    <button onclick="ejecutarOperacionCajero()" class="btn-green full-width mt-4">PROCESAR</button>
                </div>
            </div>

            <div id="cajero-otros" class="view-cajero oculto fade-in">
                <div class="glass-panel">
                    <h3><i class="fas fa-hand-holding-usd text-gold"></i> Cobro de Préstamos (Efectivo)</h3>
                    <p class="mb-2">El pago se realiza con dinero físico (ventanilla).</p>
                    <div class="grid-2-col" style="grid-template-columns: 3fr 1fr;">
                        <input type="text" id="cajero-search-loan" placeholder="Cuenta o Cédula del Cliente">
                        <button onclick="buscarClientePrestamo()" class="btn-primary">Buscar</button>
                    </div>
                    
                    <div id="cajero-loan-info" class="glass-panel oculto mt-4 fade-in">
                        <h3 class="text-gold">Deuda Pendiente</h3>
                        <p id="cajero-loan-client">Cliente: ---</p>
                        <p>Total a Pagar: <strong id="cajero-loan-amount" class="text-red">$0.00</strong></p>
                        <hr class="divider-line">
                        <input type="number" id="cajero-loan-pay" placeholder="Monto Recibido ($)" class="mt-2">
                        <button onclick="pagarPrestamoCajero()" class="btn-green full-width mt-2">REGISTRAR PAGO</button>
                    </div>
                </div>
            </div>
        </main>
    </section>

    <script type="module" src="script.js"></script>
</body>
</html>